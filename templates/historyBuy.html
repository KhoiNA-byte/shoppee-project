<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>  
  <title>Shopee</title>
</head>

<body>
<header style="background-color: tomato; padding: 32px;">
  <div class="d-grid gap-2 d-md-flex justify-content-md-end">
    {{if .User.Username}}
      <a class="btn btn-dark me-md-2 btn-sm" href="/addBalance">{{.UserBalances.Balance}}.000₫</a>
      <a class="btn btn-dark me-md-2 btn-sm position-relative" href="/addToCart">
        <i class="bi bi-cart"></i>
        {{if gt .UserCart.TotalItems 0}}
          <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill text-bg-secondary">
            {{.UserCart.TotalItems}}
          </span>
        {{end}}
      </a>
      <a class="btn btn-dark me-md-2 btn-sm text-truncate" href="/historyBuy">
        <i class="bi bi-person-circle"></i> {{.User.Username}}
      </a>
      <a class="btn btn-dark me-md-2 btn-sm" href="/logout">Logout <i class="bi bi-box-arrow-in-right"></i></a>
    {{else}}
      <a class="btn btn-dark me-md-2 btn-sm" href="/login">Login <i class="bi bi-box-arrow-in-right"></i></a>
      <a class="btn btn-dark me-md-2 btn-sm" href="/signup">Signup <i class="bi bi-box-arrow-in-right"></i></a>
    {{end}}
  </div>

  <div class="container">
    <form method="post" action="/historyBuy" autocomplete="off">
      <div class="row g-3 align-items-center">
        <div class="col-auto">
          <a href="/">
            <img src="/public/pics/wallhaven-28869x_1920x1080.png" class="img-fluid" width="50" height="50" alt="Logo">
          </a>
        </div>
        <div class="col">
          <input autofocus type="text" name="searchKey" class="form-control form-control-lg mx-auto" placeholder="Search for products...">
        </div>
        <div class="col-auto">
          <button class="btn btn-dark" type="submit"><i class="bi bi-search"></i></button>
        </div>
      </div>
    </form>
  </div>
</header>

<div class="container-fluid text-center mt-4">
  <div class="row">
    <div class="col-sm-2">
      {{if .User.Username}}
        <div>{{.User.Username}}</div>
        <!-- Button trigger modal -->
        <a href="#" class="text-decoration-none" data-bs-toggle="modal" data-bs-target="#updateModal">
          Edit profile
        </a>
      {{end}}
    </div>

    <div class="col-sm-10">
      <div class="container-sm p-0 bg-body-secondary">
        <div class="text-center">
          <div class="d-flex justify-content-between fw-bold fs-5 border-bottom pb-2">
            <div class="col-4 text-start">Product</div>
            <div class="col-2">Unit Price</div>
            <div class="col-2">Quantity</div>
            <div class="col-2">Total Price</div>
          </div>
        </div>
      </div>

      {{range .HistoriesItems}}
      <div class="container text-center">
        <div class="d-flex justify-content-between align-items-center border-bottom py-2">
          <div class="col-4 text-start">
            <a class="link-light link-underline link-underline-opacity-0" href="/detailListing?screenshotId={{.Screenshot}}">
              <img src="/public/pics/{{.Screenshot}}" style="width: 20%; height: 20%;"> {{.Name}}
            </a>
          </div>
          <div class="col-2">{{.Price}}.000₫</div>
          <div class="col-2">{{.Quantity}}</div>
          <div class="col-2">{{mul .Price .Quantity}}.000₫</div>
        </div>
      </div>
      {{end}}
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="updateModal" data-bs-backdrop="static">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">

      <!-- Modal Header -->
      <div class="modal-header">
        <h4 class="modal-title">Update Account</h4>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <!-- Modal Body -->
      <div class="modal-body">
        <form action="/historyBuy" method="POST">
          <div class="mb-3">
            <label class="form-label">Old Password</label>
            <input type="password" class="form-control" name="oldPassword" required>
          </div>
          <div class="mb-3">
            <label class="form-label">New Password</label>
            <input type="password" class="form-control" name="password" value="" required>
          </div>
          <div class="mb-3">
            <label class="form-label">New Username</label>
            <input type="text" class="form-control" name="name" value="{{.User.Username}}" required>
          </div>
          {{if .Message}}
          <div class="text-warning mb-3">{{.Message}}</div>
          {{end}}
          <div class="d-flex justify-content-end">
            <button type="submit" class="btn btn-success" name="action" value="update">Update</button>
          </div>
        </form>
      </div>

    </div>
  </div>
</div>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    var message = "{{.Message}}";
    if (message.trim() !== "") {
      var myModal = new bootstrap.Modal(document.getElementById('updateModal'));
      myModal.show();
    }
  });
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
